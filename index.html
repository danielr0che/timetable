<!DOCTYPE html>
<html>
<head>
  <title>Room Booking Timetable</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      min-width: 100px;
    }
    th { background-color: #f4f4f4; }
    .confirmed { background-color: #c8e6c9; }  /* Green */
    .pending { background-color: #fff9c4; }    /* Yellow */
    .empty { background-color: #f9f9f9; }
  </style>
</head>
<body>
  <h1>Room Booking Timetable</h1>
  <label for="datePicker">Select Date:</label>
  <input type="date" id="datePicker">

  <table id="timetable"></table>

  <script>
    const apiUrl = "YOUR_WEB_APP_URL_HERE"; // Replace with your Apps Script web app URL

    let reservations = [];

    fetch(apiUrl)
      .then(res => res.json())
      .then(data => {
        reservations = data.map(r => {
          r.checkInDate = new Date(r["Check-In"]);
          r.checkOutDate = new Date(r["Check-Out"]);
          return r;
        });
        showTimetable(new Date());
      });

    const dateInput = document.getElementById("datePicker");
    dateInput.valueAsDate = new Date();
    dateInput.addEventListener("change", () => {
      showTimetable(new Date(dateInput.value));
    });

    function showTimetable(selectedDate) {
      const timetable = document.getElementById("timetable");
      timetable.innerHTML = "";

      // Setup
      const startHour = 8;
      const endHour = 20;
      const hours = Array.from({ length: endHour - startHour }, (_, i) => startHour + i);

      // Get unique room numbers
      const roomNumbers = [...new Set(reservations.map(r => r["Room Number"]))].sort((a, b) => a - b);

      // Header row
      const thead = document.createElement("thead");
      const headRow = document.createElement("tr");
      headRow.appendChild(document.createElement("th")).innerText = "Time";
      roomNumbers.forEach(room => {
        const th = document.createElement("th");
        th.innerText = `Room ${room}`;
        headRow.appendChild(th);
      });
      thead.appendChild(headRow);
      timetable.appendChild(thead);

      // Table body
      const tbody = document.createElement("tbody");
      hours.forEach(hour => {
        const row = document.createElement("tr");
        const timeCell = document.createElement("td");
        timeCell.innerText = `${String(hour).padStart(2, '0')}:00`;
        row.appendChild(timeCell);

        roomNumbers.forEach(room => {
          const cell = document.createElement("td");
          const res = reservations.find(r => {
            const start = r.checkInDate;
            const end = r.checkOutDate;
            const sameDay =
              start.getDate() === selectedDate.getDate() &&
              start.getMonth() === selectedDate.getMonth() &&
              start.getFullYear() === selectedDate.getFullYear();
            return (
              r["Room Number"] == room &&
              sameDay &&
              hour >= start.getHours() &&
              hour < end.getHours()
            );
          });

          if (res) {
            const status = res["Status"];
            cell.innerText = res["Student Email"];
            cell.className = status === "Confirmed" ? "confirmed" :
                             status === "Pending Approval" ? "pending" : "empty";
          } else {
            cell.innerText = "";
            cell.className = "empty";
          }

          row.appendChild(cell);
        });

        tbody.appendChild(row);
      });

      timetable.appendChild(tbody);
    }
  </script>
</body>
</html>
