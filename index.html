<!DOCTYPE html>
<html>
<head>
  <title>Room Reservation Timetable</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #f4f4f4;
    }
    input[type="date"] {
      padding: 5px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>Reservation Timetable</h1>
  <label for="datePicker">Select Date:</label>
  <input type="date" id="datePicker">

  <table id="reservationTable">
    <thead>
      <tr>
        <th>Room Number</th>
        <th>Student Email</th>
        <th>Check-In</th>
        <th>Check-Out</th>
        <th>Time (hrs)</th>
        <th>Status</th>
        <th>Checked Time</th>
        <th>Check-in Status</th>
        <th>Dual Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const apiUrl = "https://script.google.com/a/macros/tcd.ie/s/AKfycbxzbUjTzZarXVcz5iZWjECjcJwLB5Y67twBFEWu8caYdvYtUJkTRp_CDRIAl5wCdFdPjQ/exec";

    let allReservations = [];

    fetch(apiUrl)
      .then(res => res.json())
      .then(data => {
        allReservations = data.map(entry => {
          entry["Parsed Check-In"] = new Date(entry["Check-In"]);
          return entry;
        });
        showFilteredReservations(); // load today's data
      });

    const dateInput = document.getElementById('datePicker');
    dateInput.valueAsDate = new Date();
    dateInput.addEventListener('change', showFilteredReservations);

    function showFilteredReservations() {
      const selectedDate = new Date(dateInput.value);
      const tableBody = document.querySelector('#reservationTable tbody');
      tableBody.innerHTML = '';

      const filtered = allReservations.filter(r => {
        const d = r["Parsed Check-In"];
        return d.getFullYear() === selectedDate.getFullYear() &&
               d.getMonth() === selectedDate.getMonth() &&
               d.getDate() === selectedDate.getDate();
      });

      if (filtered.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="9">No reservations for this date.</td></tr>`;
        return;
      }

      for (const row of filtered) {
        const tr = document.createElement('tr');
        [
          "Room Number", "Student Email", "Check-In", "Check-Out",
          "Time", "Status", "Checked Time", "Check-in Status", "Dual Status"
        ].forEach(key => {
          const td = document.createElement('td');
          td.textContent = row[key] || '';
          tr.appendChild(td);
        });
        tableBody.appendChild(tr);
      }
    }
  </script>
</body>
</html>
